@model AnimeCentralWeb.Models.DomainViewModels.EpisodeViewModel

<div class="content">
    <div class="content-header">
        <div class="title">@Model.Title</div>
        <div class="description">@Model.AnimeTitle - #@Model.Order</div>
    </div>
    <div class="commands text-right">
        <div class="back-to-anime anime-popup command" data-anime-id="@Model.AnimeId" data-popup-clear="true"><i class="fa fa-chevron-left" aria-hidden="true"></i> Anime</div>
        <div class="command close-pop-up"><i class="fa fa-times" aria-hidden="true"></i></div>
    </div>
    <div class="content-body episode-view">
        <div class="multi-tab">
            <table class="tabs-labels">
                <tr>
                    @{
                        @foreach (var source in Model.Sources)
                        {
                            <td style="display:table-cell" data-tab-target="#@(Model.Sources.IndexOf(source))" class="tab-label @(Model.Sources.IndexOf(source) == 0 ? "active" : "")">@source.Label</td>
                        }
                    }
                </tr>
            </table>

            <div class="tabs">
                @foreach (var source in Model.Sources)
                {

                    <div class="tab @(Model.Sources.IndexOf(source) == 0 ? "active" : "")" data-tab-id="#@(Model.Sources.IndexOf(source))">
                        @if (source.Origin == AnimeCentralWeb.Domain.SourceOrigin.External)
                        {
                            <iframe class="episode-frame" src="@source.Link" frameborder=0 marginwidth=0 marginheight=0 scrolling="no" width=100% height=100% allowfullscreen></iframe>
                        }
                        else
                        {
                            <video width="100%" height="100%" controls preload="auto">
                                <source src="/Anime/VideoStream/@Model.Id" type="video/mp4" />
                                <source src="/Anime/VideoStream/@Model.Id" type="video/ogg" />
                            </video>
                        }
                    </div>
                }
            </div>
            <div class="episode-commands">
                <div class="edit-episode" data-episode-id="@Model.Id">Editeaza</div>
                @if (Model.Next != -1)
                {
                    <div class="episode-popup" data-episode-id="@Model.Next">Urmatorul</div>
                }

                @if (Model.Previous != -1)
                {
                    <div class="episode-popup" data-episode-id="@Model.Previous">Precendentul</div>
                }
            </div>
            <div class="view-count"><i class="fa fa-eye" aria-hidden="true"></i> Vizionari: @Model.ViewCount</div>
            <div class="new-comment">
                <form class="new-comment-form">
                    <input type="hidden" name="EpisodeId" value="@Model.Id" />
                    <textarea class="comment-input" name="Content" placeholder="Scrie un comentariu..." />
                    <div class="comment-btn"><a>Comenteaza</a></div>
                </form>
            </div>
            <div class="comments-container"></div>
        </div>
    </div>
    <script>
        $(document).ready(function () {
            RefreshComments();
        });


        function RefreshComments() {
          $.get("Anime/GetComments?id=" + @Model.Id, function (data) {
            $(".comments-container").html(data);
          }).fail(function (data) {
            alert("A aparut o problema in afisarea ultimelor comentarii comentarilor.");
          });
        }

        $(".episode-frame").load(function () {
            $(".video-js").css("height", "100%");
            $(".video-js").css("padding-top", "0");
        });

    </script>
</div>